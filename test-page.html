<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP ì„œë²„ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { margin: 5px; padding: 8px 12px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 3px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        input { padding: 5px; margin: 5px; width: 100px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª MCP ì„œë²„ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>
    
    <div class="test-section">
        <h3>ì—°ê²° ìƒíƒœ</h3>
        <div id="connection-status">ì—°ê²° ì¤‘...</div>
        <button onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
    </div>

    <div class="test-section">
        <h3>ê¸°ë³¸ ê°€êµ¬ ì¶”ê°€</h3>
        <button onclick="addFurniture('chair')">ì˜ì ì¶”ê°€</button>
        <button onclick="addFurniture('table')">í…Œì´ë¸” ì¶”ê°€</button>
        <button onclick="addFurniture('sofa')">ì†ŒíŒŒ ì¶”ê°€</button>
    </div>

    <div class="test-section">
        <h3>ê°€êµ¬ ì„ íƒ</h3>
        <input type="number" id="select-index" placeholder="ì¸ë±ìŠ¤" value="0" min="0">
        <button onclick="selectFurniture()">ê°€êµ¬ ì„ íƒ</button>
    </div>

    <div class="test-section">
        <h3>ê°€êµ¬ ì´ë™</h3>
        <input type="number" id="move-id" placeholder="ê°€êµ¬ ID" value="0" step="0.1">
        <input type="number" id="move-x" placeholder="X" value="2" step="0.1">
        <input type="number" id="move-y" placeholder="Y" value="0.5" step="0.1">
        <input type="number" id="move-z" placeholder="Z" value="1" step="0.1">
        <button onclick="moveFurniture()">ì´ë™</button>
    </div>

    <div class="test-section">
        <h3>ê°€êµ¬ íšŒì „</h3>
        <input type="number" id="rotate-id" placeholder="ê°€êµ¬ ID" value="0" step="0.1">
        <input type="number" id="rotate-x" placeholder="X" value="0" step="0.1">
        <input type="number" id="rotate-y" placeholder="Y" value="1.57" step="0.1">
        <input type="number" id="rotate-z" placeholder="Z" value="0" step="0.1">
        <button onclick="rotateFurniture()">íšŒì „</button>
    </div>

    <div class="test-section">
        <h3>ì¥ë©´ ê´€ë¦¬</h3>
        <button onclick="saveScene()">ì¥ë©´ ì €ì¥</button>
        <button onclick="loadScene()">ì¥ë©´ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button onclick="clearFurnitures()">ëª¨ë“  ê°€êµ¬ ì‚­ì œ</button>
    </div>

    <div class="test-section">
        <h3>ìƒíƒœ ì¡°íšŒ</h3>
        <button onclick="getState()">í˜„ì¬ ìƒíƒœ ë³´ê¸°</button>
        <button onclick="listFurnitures()">ê°€êµ¬ ëª©ë¡</button>
    </div>

    <div class="test-section">
        <h3>ë¡œê·¸</h3>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        <div id="log" class="log"></div>
    </div>

    <script>
        let ws = null;
        let requestId = 0;

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function connect() {
            ws = new WebSocket('ws://127.0.0.1:7801/rpc');
            
            ws.onopen = () => {
                document.getElementById('connection-status').textContent = 'âœ… ì—°ê²°ë¨';
                log('MCP ì„œë²„ì— ì—°ê²°ë¨');
            };
            
            ws.onmessage = (event) => {
                try {
                    const response = JSON.parse(event.data);
                    log(`ì‘ë‹µ: ${JSON.stringify(response, null, 2)}`);
                } catch (e) {
                    log(`ì›ì‹œ ì‘ë‹µ: ${event.data}`);
                }
            };
            
            ws.onerror = (error) => {
                log(`ì˜¤ë¥˜: ${error.message}`);
            };
            
            ws.onclose = () => {
                document.getElementById('connection-status').textContent = 'âŒ ì—°ê²° ëŠê¹€';
                log('ì—°ê²°ì´ ëŠì–´ì§');
            };
        }

        function sendRequest(method, params) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ ì„œë²„ì— ì—°ê²°ë˜ì§€ ì•ŠìŒ');
                return;
            }
            
            const request = {
                id: ++requestId,
                method,
                params
            };
            
            log(`ìš”ì²­: ${method} - ${JSON.stringify(params)}`);
            ws.send(JSON.stringify(request));
        }

        function testConnection() {
            sendRequest('describeTools', {});
        }

        function addFurniture(type) {
            sendRequest('add_furniture', { type });
        }

        function selectFurniture() {
            const index = parseInt(document.getElementById('select-index').value);
            sendRequest('select_furniture', { index });
        }

        function moveFurniture() {
            const id = parseInt(document.getElementById('move-id').value);
            const x = parseFloat(document.getElementById('move-x').value);
            const y = parseFloat(document.getElementById('move-y').value);
            const z = parseFloat(document.getElementById('move-z').value);
            sendRequest('move_furniture', { id, position: [x, y, z] });
        }

        function rotateFurniture() {
            const id = parseInt(document.getElementById('rotate-id').value);
            const x = parseFloat(document.getElementById('rotate-x').value);
            const y = parseFloat(document.getElementById('rotate-y').value);
            const z = parseFloat(document.getElementById('rotate-z').value);
            sendRequest('rotate_furniture', { id, rotation: [x, y, z] });
        }

        function saveScene() {
            sendRequest('save_scene', {});
        }

        function loadScene() {
            sendRequest('load_scene', {});
        }

        function clearFurnitures() {
            sendRequest('clear_furnitures', {});
        }

        function getState() {
            sendRequest('get_state', {});
        }

        function listFurnitures() {
            sendRequest('list_furnitures', {});
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì—°ê²°
        window.onload = connect;
    </script>
</body>
</html>
